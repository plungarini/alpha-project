(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{F34d:function(e,t,i){"use strict";i.d(t,"a",function(){return l});var r=i("0RTl"),o=i("tyNb"),s=i("lPP5"),n=i("fXoL");let l=(()=>{let e=class{constructor(e,t){const i=t.useRef("router");e.events.subscribe(t=>{const r=this.getCurrentNavigationState(e);r&&r.ignoreLoadingBar||(t instanceof o.e&&i.start(),(t instanceof o.d||t instanceof o.c||t instanceof o.b)&&i.complete())})}getCurrentNavigationState(e){const t=e.getCurrentNavigation&&e.getCurrentNavigation();return t&&t.extras?t.extras.state:{}}};return e.\u0275mod=n.Kb({type:e}),e.\u0275inj=n.Jb({factory:function(t){return new(t||e)(n.Wb(o.g),n.Wb(s.d))},imports:[[o.k,s.c],o.k,s.c]}),e=Object(r.c)([Object(r.f)("design:paramtypes",[o.g,s.d])],e),e})()},Wt4L:function(e,t,i){"use strict";i.d(t,"a",function(){return l});var r=i("mrSG"),o=i("fXoL"),s=i("L7YA"),n=i("qfxJ");let l=(()=>{class e{constructor(e,t){this.db=e,this.vimeoService=t,this.placeholderImage="/assets/images/AL_temp-logo.jpg",this.exBatch=new Set}upsert(e){var t,i;return Object(r.a)(this,void 0,void 0,function*(){if(!e)return;if("riposo"===(null===(t=e.title)||void 0===t?void 0:t.trim().toLowerCase())||"rest"===(null===(i=e.title)||void 0===i?void 0:i.trim().toLowerCase())||"./../../../assets/icons/workout/workout-rest-icon.svg"===e.iconSrc)return;if(e.title||delete e.title,e.iconId||delete e.iconId,e.iconSrc||delete e.iconSrc,e.exerciseId||delete e.exerciseId,e.note||delete e.note,!e)return;e.videoLink&&(e=yield this.getThumbVimeo(e));const r=e.exerciseId?e.exerciseId:this.db.generateId();e.exerciseId=r,this.db.upsert(`workout-exercises/${r}`,e)})}get(e){return this.db.doc$(`workout-exercises/${e}`)}getAll(){return this.db.col$("workout-exercises")}delete(e){this.db.delete(`workout-exercises/${e}`)}addToBatch(e){var t,i,r,o,s,n,l,a;if(this.exBatch.size<=0)this.exBatch.add(e);else{let c=!1;const d=[...this.exBatch];let u=d.length;for(;u--&&!c;){const h=d[u];c=(null===(t=e.title)||void 0===t?void 0:t.trim().toLowerCase())===(null===(i=h.title)||void 0===i?void 0:i.trim().toLowerCase())&&e.iconId===h.iconId&&(null===(r=e.iconSrc)||void 0===r?void 0:r.trim().toLowerCase())===(null===(o=h.iconSrc)||void 0===o?void 0:o.trim().toLowerCase())||(null===(s=e.title)||void 0===s?void 0:s.trim().toLowerCase())===(null===(n=h.title)||void 0===n?void 0:n.trim().toLowerCase())||(null===(l=e.videoLink)||void 0===l?void 0:l.trim().toLowerCase())===(null===(a=h.videoLink)||void 0===a?void 0:a.trim().toLowerCase())}c||this.exBatch.add(e)}}commitBatch(){this.exBatch.size<=0||(this.exBatch.forEach(e=>{this.upsert(e)}),this.exBatch.clear())}getThumbVimeo(e){var t;return Object(r.a)(this,void 0,void 0,function*(){if(!e)return e;e.videoThumbnail=this.placeholderImage;const i=parseInt((null===(t=e.videoLink)||void 0===t?void 0:t.split("/")[3])||"");if(!i)return e;const r=yield this.vimeoService.getVideo(i);(r instanceof Error||!r)&&console.error(JSON.parse(r));const o=r.pictures.sizes.filter(e=>e.width>=640&&e.width<=1280);return o?(e.videoThumbnail=o[0].link,e):e})}}return e.\u0275fac=function(t){return new(t||e)(o.Wb(s.a),o.Wb(n.a))},e.\u0275prov=o.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},oV2P:function(e,t,i){"use strict";i.r(t),i.d(t,"ProfileModule",function(){return C});var r=i("ofXK"),o=i("PCNd"),s=i("tyNb"),n=i("mrSG"),l=i("Jgta"),a=i("fXoL"),c=i("FYjP"),d=i("n45d"),u=i("3Pt+"),h=i("XNiG"),m=i("1G5W"),b=i("lyTB"),f=i("fbMX"),p=i("TVmF"),g=i("PT0D");const v=function(e,t,i,r){return{img:e,fullName:t,email:i,color:r}};let y=(()=>{class e{constructor(e,t,i,r){this.authService=e,this.storageService=t,this.userService=i,this.cdRef=r,this.onAlert=new a.n,this.destroyed$=new h.a,this.form=new u.h({firstName:new u.e(null,[u.r.required]),lastName:new u.e(null,[u.r.required]),email:new u.e(null,[u.r.required])})}ngOnInit(){this.authService.user$.pipe(Object(m.a)(this.destroyed$)).subscribe(e=>{e&&(this.user=e,this.form.patchValue({firstName:e.name.split(" ")[0],lastName:e.name.split(" ")[1],email:e.email}),this.cdRef.detectChanges())}),this.authService.fireUser$.pipe(Object(m.a)(this.destroyed$)).subscribe(e=>{e&&(this.fireUser=e)})}ngOnDestroy(){this.destroyed$.next()}changeUserName(){var e,t;const i=(null===(e=this.form.get("firstName"))||void 0===e?void 0:e.value)||"",r=(null===(t=this.form.get("lastName"))||void 0===t?void 0:t.value)||"";this.fireUser.updateProfile({displayName:i+" "+r,photoUrl:this.fireUser.photoURL}).then(e=>{this.userService.editOrCreate(this.fireUser,!0,{roles:this.user.roles}).then(()=>{this.onAlert.emit({type:"success",title:"Modifiche salvate con successo!"})})})}uploadImage(e){if(!e)return;const t=e.files[0],i=`users/${this.user.id}/media/profile`,{downloadUrl$:r,fileReference:o}=this.storageService.uploadFileAndGetMetadata(i,t);r.pipe(Object(m.a)(this.destroyed$)).subscribe(e=>{e&&this.updateProfileImage(e,o)})}updateProfileImage(e,t){var i,r;return Object(n.a)(this,void 0,void 0,function*(){const o={displayName:this.user.name,photoURL:e},s={profileUrlRef:t,roles:this.user.roles};(null===(i=this.user.details)||void 0===i?void 0:i.profileUrlRef)&&this.storageService.deleteFile(null===(r=this.user.details)||void 0===r?void 0:r.profileUrlRef),this.fireUser.updateProfile(o).then(e=>{this.userService.editOrCreate(this.fireUser,!0,s).then(()=>{this.onAlert.emit({type:"success",title:"Modifiche salvate con successo!"})})})})}}return e.\u0275fac=function(t){return new(t||e)(a.Mb(b.a),a.Mb(f.a),a.Mb(p.a),a.Mb(a.h))},e.\u0275cmp=a.Gb({type:e,selectors:[["app-my-profile"]],outputs:{onAlert:"onAlert"},decls:29,vars:9,consts:[["aria-labelledby","payment_details_heading"],[3,"formGroup","ngSubmit"],[1,"shadow","sm:rounded-md","sm:overflow-hidden"],[1,"bg-black-700","py-6","px-4","sm:p-6"],["id","payment_details_heading",1,"text-lg","leading-6","font-medium","text-gray-100"],[1,"mt-1","text-sm"],["type","file","accept","image/png, image/jpeg",1,"hidden",3,"change"],["profilePicture",""],[1,"mt-6","flex","flex-row","items-center","space-x-6"],["displayType","img",1,"transform","scale-200","mx-6",3,"user","enableProfileLink","click"],[1,"grid","grid-cols-2","gap-6","w-full"],[1,"col-span-2","sm:col-span-1"],["for","first_name",1,"block","text-sm","font-medium","text-gray-500"],["formControlName","firstName","type","text","name","first_name","id","first_name","autocomplete","cc-given-name",1,"mt-1","block","w-full","border","border-gray-500","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","bg-black-800","sm:text-sm"],["for","last_name",1,"block","text-sm","font-medium","text-gray-500"],["formControlName","lastName","type","text","name","last_name","id","last_name","autocomplete","cc-family-name",1,"mt-1","block","w-full","border","border-gray-500","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","bg-black-800","sm:text-sm"],[1,"col-span-2"],["for","email_address",1,"block","text-sm","font-medium","text-gray-500"],["formControlName","email","type","text","name","email_address","id","email_address",1,"mt-1","block","w-full","cursor-not-allowed","opacity-70","border","border-gray-500","rounded-md","shadow-sm","py-2","px-3","focus:outline-none","bg-black-800","sm:text-sm",3,"disabled"],[1,"px-4","py-3","bg-black-800","text-right","sm:px-6"],["type","submit",1,"btn","primary"]],template:function(e,t){if(1&e){const e=a.Tb();a.Sb(0,"section",0),a.Sb(1,"form",1),a.Zb("ngSubmit",function(){return t.changeUserName()}),a.Sb(2,"div",2),a.Sb(3,"div",3),a.Sb(4,"div"),a.Sb(5,"h2",4),a.Ec(6,"Dati personali"),a.Rb(),a.Sb(7,"p",5),a.Ec(8,"Aggiorna tutti i dati relativi al tuo profilo."),a.Rb(),a.Rb(),a.Sb(9,"input",6,7),a.Zb("change",function(e){return t.uploadImage(e.target)}),a.Rb(),a.Sb(11,"div",8),a.Sb(12,"app-avatar",9),a.Zb("click",function(){return a.vc(e),a.tc(10).click()}),a.Rb(),a.Sb(13,"div",10),a.Sb(14,"div",11),a.Sb(15,"label",12),a.Ec(16,"Nome"),a.Rb(),a.Nb(17,"input",13),a.Rb(),a.Sb(18,"div",11),a.Sb(19,"label",14),a.Ec(20,"Cognome"),a.Rb(),a.Nb(21,"input",15),a.Rb(),a.Sb(22,"div",16),a.Sb(23,"label",17),a.Ec(24,"Indirizzo Email"),a.Rb(),a.Nb(25,"input",18),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Sb(26,"div",19),a.Sb(27,"button",20),a.Ec(28," Salva "),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Rb()}2&e&&(a.Ab(1),a.jc("formGroup",t.form),a.Ab(11),a.jc("user",a.oc(4,v,(null==t.user||null==t.user.details?null:t.user.details.imgUrl)||"",(null==t.user?null:t.user.name)||"",(null==t.user?null:t.user.email)||"",(null==t.user||null==t.user.details?null:t.user.details.imgColorBg)||"indigo"))("enableProfileLink",!1),a.Ab(13),a.jc("disabled",!0))},directives:[u.s,u.m,u.i,g.a,u.b,u.l,u.g],encapsulation:2,changeDetection:0}),e})();const w=function(e,t){return{"bg-black-700 text-gray-100 font-bold shadow-2xl ring-1 ring-indigo-400 mb-2":e,"text-gray-400 hover:text-gray-200 hover:bg-gray-700":t}},x=function(e,t){return{"text-gray-100":e,"text-gray-400 group-hover:text-gray-200":t}};function S(e,t){if(1&e){const e=a.Tb();a.Qb(0),a.Sb(1,"div",7),a.Zb("click",function(){a.vc(e);const i=t.$implicit;return a.dc().toggleSection(i.id)}),a.Nb(2,"i-bs",8),a.Sb(3,"span",9),a.Ec(4),a.Rb(),a.Rb(),a.Pb()}if(2&e){const e=t.$implicit;a.Ab(1),a.jc("ngClass",a.mc(4,w,e.selected,!e.selected)),a.Ab(1),a.jc("name",e.icon)("ngClass",a.mc(7,x,e.selected,!e.selected)),a.Ab(2),a.Gc(" ",e.title," ")}}function k(e,t){if(1&e){const e=a.Tb();a.Sb(0,"app-my-profile",10),a.Zb("onAlert",function(t){return a.vc(e),a.dc().toggleAlert(t)}),a.Rb()}}const N=[{path:"",component:(()=>{class e{constructor(){this.pageTitle="Impostazioni",this.showSaved=!0,this.settingsNav=[{id:1,selected:!0,icon:"personCircle",title:"Profilo"},{id:2,selected:!1,icon:"gearFill",title:"Preferenze"},{id:3,selected:!1,icon:"bellFill",title:"Notifiche"},{id:4,selected:!1,icon:"creditCardFill",title:"Pagamenti"}],this.showMyProfile=!1,this.showPreferences=!1,this.showNotifications=!1,this.showAlert=!1,this.alertTitle="",this.alertDesc="",this.alertIcon="",this.alertType="info",this.ffn=l.a.app().functions("europe-west2"),this.getStripePortalLink=this.ffn.httpsCallable("ext-firestore-stripe-subscriptions-createPortalLink")}ngOnInit(){this.toggleSection(1)}toggleSection(e){!e||e>this.settingsNav.length||(this.showMyProfile=!1,this.showPreferences=!1,this.showNotifications=!1,this.settingsNav.forEach(e=>e.selected=!1),this.settingsNav[e-1].selected=!0,1===e?this.showMyProfile=!0:2===e?this.showPreferences=!0:3===e?this.showNotifications=!0:4===e&&this.navigateToPortalLink())}toggleAlert(e){this.showAlert=!0,this.alertTitle=e.title,this.alertType=e.type,setTimeout(()=>{this.showAlert=!1},3e3)}navigateToPortalLink(){return Object(n.a)(this,void 0,void 0,function*(){this.showAlert=!0,this.alertTitle="Attendi...",this.alertDesc="Stiamo creando un accesso sicuro al tuo portale.",this.alertIcon="cloudArrowDownFill",this.alertType="info";const{data:e}=yield this.getStripePortalLink({returnUrl:window.location.href});window.open(e.url,"_self")})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Gb({type:e,selectors:[["app-profile"]],decls:7,vars:6,consts:[[1,"lg:grid","lg:grid-cols-12","lg:gap-x-5"],[1,"py-6","px-2","sm:px-6","lg:py-0","lg:px-0","lg:col-span-3"],[1,"space-y-1"],[4,"ngFor","ngForOf"],[1,"space-y-6","sm:px-6","lg:px-0","lg:col-span-9"],[3,"onAlert",4,"ngIf"],[3,"show","type","title","desc"],[1,"group","rounded-md","px-4","py-3","flex","items-center","text-sm","font-medium","cursor-pointer",3,"ngClass","click"],["width","1.3rem","height","1.3rem",1,"flex-shrink-0","mr-3",3,"name","ngClass"],[1,"truncate"],[3,"onAlert"]],template:function(e,t){1&e&&(a.Sb(0,"div",0),a.Sb(1,"aside",1),a.Sb(2,"nav",2),a.Cc(3,S,5,10,"ng-container",3),a.Rb(),a.Rb(),a.Sb(4,"div",4),a.Cc(5,k,1,0,"app-my-profile",5),a.Rb(),a.Rb(),a.Nb(6,"app-alert",6)),2&e&&(a.Ab(3),a.jc("ngForOf",t.settingsNav),a.Ab(2),a.jc("ngIf",t.showMyProfile),a.Ab(1),a.jc("show",t.showAlert)("type",t.alertType)("title",t.alertTitle)("desc",t.alertDesc))},directives:[r.l,r.m,c.a,r.k,d.a,y],encapsulation:2}),e})()}];let R=(()=>{class e{}return e.\u0275mod=a.Kb({type:e}),e.\u0275inj=a.Jb({factory:function(t){return new(t||e)},imports:[[s.k.forChild(N)],s.k]}),e})(),C=(()=>{class e{}return e.\u0275mod=a.Kb({type:e}),e.\u0275inj=a.Jb({factory:function(t){return new(t||e)},imports:[[r.c,R,o.a,u.p]]}),e})()}}]);